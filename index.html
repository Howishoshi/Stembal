<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>XI-JUDGES STEM — Official</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --purple:#5b3ea6;
    --purple-2:#6b4bd0;
    --cream:#f5eedf;
    --max-width:1200px;
    --gap:20px;
    --muted:#666;
    --footer-bg:#faf8ff;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;
    margin:0;color:#222;background:#fff;line-height:1.45;
    display:flex;flex-direction:column;min-height:100vh;
    -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
  }

  /* header */
  header{background:#fff;border-bottom:1px solid rgba(0,0,0,0.06);position:sticky;top:0;z-index:120}
  .container{max-width:var(--max-width);margin:0 auto;padding:14px 18px}
  .topbar{display:flex;align-items:center;gap:12px}
  .logo{height:56px;width:auto;object-fit:contain}
  .site-title{margin-left:6px}
  .site-title .name{font-weight:700;color:var(--purple);font-size:16px}
  .site-title .tag{font-size:12px;color:var(--muted)}
  .hamburger{width:44px;height:44px;border-radius:8px;border:0;background:transparent;display:none;align-items:center;justify-content:center;cursor:pointer;font-size:20px;margin-right:6px;}
  .header-actions{margin-left:auto;display:flex;gap:10px;align-items:center}
  .mobile-toggle{display:none;background:transparent;border:0;color:var(--purple);cursor:pointer;font-size:18px;padding:8px;border-radius:8px}
  .mobile-toggle:focus{outline:2px solid rgba(91,62,166,0.18)}

  nav{margin-left:auto}
  nav ul{display:flex;gap:14px;list-style:none;padding:0;margin:0;align-items:center}
  nav a{color:var(--purple);text-decoration:none;font-weight:600;cursor:pointer;padding:6px 8px}
  nav a:hover{text-decoration:underline}

  /* header mobile nav area (toggled) */
  .mobile-nav{display:none;background:#fff;border-bottom:1px solid rgba(0,0,0,0.04)}
  .mobile-nav.open{display:block}
  .mobile-nav .links{display:flex;flex-direction:column;padding:8px 18px;gap:6px}
  .mobile-nav .links a{padding:10px 12px;border-radius:8px;color:var(--purple);text-decoration:none;font-weight:600}
  .mobile-nav .links a:hover{background:rgba(91,62,166,0.04)}

  /* main should expand so footer is pushed to bottom when content short */
  main.container{flex:1;padding:18px}

  /* layout */
  .layout{display:grid;grid-template-columns:260px 1fr;gap:var(--gap);align-items:start;padding:24px}
  body.sidebar-hidden .layout{grid-template-columns:1fr}
  @media(max-width:900px){.layout{grid-template-columns:1fr;padding:12px}}

  /* sidebar */
  .sidebar{background:linear-gradient(180deg, rgba(91,62,166,0.02), transparent);padding:16px;border-radius:8px;transition:transform .18s ease,opacity .18s;z-index:130}
  .sidebar h4{margin:0 0 8px 0;color:var(--purple)}
  .sidebar p{margin:0;color:var(--muted)}
  @media(max-width:900px){
    .sidebar{position:fixed;left:0;top:72px;height:calc(100vh - 72px);width:80%;max-width:360px;z-index:140;box-shadow:0 20px 40px rgba(0,0,0,0.14);transform:translateX(-120%);opacity:0}
    body.sidebar-open .sidebar{transform:translateX(0);opacity:1}
    .hamburger{display:flex}
    nav ul{display:none} /* hide top nav on small screens; use mobile-nav or sidebar */
    .mobile-toggle{display:inline-flex}
  }
  body.sidebar-hidden .sidebar{display:none}

  .breadcrumbs{font-size:13px;color:var(--muted);margin-bottom:12px;padding-left:6px;padding-right:6px}

  /* hero (landscape look) */
  .hero{position:relative;border-radius:10px;overflow:hidden;background:#222;color:#fff}
  .hero img{width:100%;height:420px;object-fit:cover;display:block;user-select:none}
  @media(max-width:900px){ .hero img{height:220px} }
  @media(max-width:480px){ .hero img{height:180px} }

  /* home categories (3-column cards) */
  .home-cats{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:18px;margin-top:18px}
  .cat-card{background:var(--cream);padding:18px;border-radius:10px;box-shadow:0 6px 18px rgba(16,12,40,0.04)}
  .cat-card h3{margin:0 0 8px 0;color:var(--purple)}
  .cat-list{margin:8px 0 0 0;padding:0;list-style:none}
  .cat-list li{margin:6px 0}
  .cat-list a{color:var(--purple);text-decoration:none;font-weight:600}
  .cat-list a:hover{text-decoration:underline}

  /* grids */
  .subjects-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px}
  .subject-card{background:var(--cream);padding:12px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.04);display:flex;flex-direction:column;justify-content:space-between;min-height:120px}
  .subject-card h3{margin:0 0 8px 0;color:var(--purple);font-size:18px}
  .gallery-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px}
  .thumb{width:100%;aspect-ratio:16/9;background:#ddd;border-radius:6px;overflow:hidden;cursor:pointer}
  .thumb img{width:100%;height:100%;object-fit:cover;display:block}

  /* lesson */
  .lesson{background:#fff;padding:18px;border-radius:8px}
  .lesson h1{margin:0 0 8px 0}
  .meta{color:var(--muted);font-size:14px;margin-bottom:12px}
  .resources{display:flex;flex-direction:column;gap:8px;margin-top:12px}
  .btn{display:inline-block;padding:10px 12px;border-radius:6px;text-decoration:none;background:var(--purple);color:#fff;font-weight:600;border:0}

  /* responsive video wrapper */
  .video-wrap{position:relative;width:100%;padding-top:56.25%;margin-top:12px;border-radius:8px;overflow:hidden;background:#000}
  .video-wrap iframe{position:absolute;top:0;left:0;width:100%;height:100%;border:0}

  /* email button (outline variant) */
  .btn-outline{background:#fff;color:var(--purple);border:1px solid rgba(91,62,166,0.12)}

  /* search */
  .search{display:flex;gap:8px;margin:12px 0}
  .search input{flex:1;padding:10px;border-radius:6px;border:1px solid #ddd}
  .search button{padding:8px 12px;border-radius:6px;background:var(--cream);border:1px solid rgba(0,0,0,0.06);cursor:pointer}

  /* social */
  .social-row{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}
  .social-btn{display:inline-flex;align-items:center;gap:10px;padding:8px 12px;border-radius:999px;color:#fff;text-decoration:none;font-weight:700;box-shadow:0 8px 28px rgba(99,66,182,0.12);transition:transform .14s,box-shadow .14s,opacity .14s;align-items:center;}
  .social-btn .icon{width:18px;height:18px;display:inline-flex;align-items:center;justify-content:center;flex:0 0 18px}
  .social-fb{background:linear-gradient(135deg,var(--purple),var(--purple-2))}
  .social-ig{background:linear-gradient(135deg,#f58529,#dd2a7b,#8134af);background-size:200% 200%}
  .social-mail{background:#fff;color:var(--purple);border:1px solid rgba(91,62,166,0.08)}
  .social-btn:hover{transform:translateY(-4px);box-shadow:0 16px 40px rgba(99,66,182,0.18)}
  .social-mail:hover{background:var(--cream);color:var(--purple)}

  /* modal */
  .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.75);display:none;align-items:center;justify-content:center;z-index:9999;padding:20px}
  .modal-backdrop.active{display:flex}
  .modal-img{max-width:95vw;max-height:95vh;border-radius:8px;box-shadow:0 6px 30px rgba(0,0,0,.6);transition:transform .18s ease}
  #modalClose{position:absolute;top:18px;right:18px;background:transparent;border:0;color:#fff;font-size:22px;cursor:pointer}

  /* footer main layout */
  footer{padding:22px 20px;background:var(--footer-bg);border-top:1px solid rgba(0,0,0,0.03);color:var(--muted);font-size:14px;}
  .footer-grid{max-width:var(--max-width);margin:0 auto;display:grid;grid-template-columns:120px 1fr 260px;gap:18px;align-items:center}
  @media(max-width:900px){ .footer-grid{grid-template-columns:1fr;gap:12px;text-align:center} .footer-grid .footer-col-right{order:3} }

  .footer-logo{width:76px;height:76px;border-radius:50%;overflow:hidden;border:3px solid rgba(91,62,166,0.08);display:flex;align-items:center;justify-content:center;background:#fff;margin:auto;}
  .footer-logo img{width:64px;height:64px;object-fit:cover;border-radius:50%}

  .footer-nav{display:flex;flex-direction:column;gap:8px}
  .footer-nav a{color:var(--purple);text-decoration:none;font-weight:600}
  .footer-nav a:hover{text-decoration:underline}

  .footer-contact{display:flex;flex-direction:column;gap:8px;align-items:flex-end}
  .footer-contact .contact-row{display:flex;gap:8px;align-items:center}
  .footer-contact a{color:var(--purple);text-decoration:none}
  .footer-small{margin-top:12px;color:var(--muted);font-size:13px}

  /* mobile tweaks */
  @media(max-width:900px){
    .home-cats{grid-template-columns:1fr}
    .gallery-grid{grid-template-columns:repeat(2,1fr)}
    .subject-card{min-height:unset}
    .btn{width:100%}
    .btn-outline{width:auto}
    .footer-contact{align-items:center}
    .footer-nav{flex-direction:row;flex-wrap:wrap;justify-content:center;gap:12px}
    .breadcrumbs{padding-left:6px;padding-right:6px}
    .site-title .name{font-size:14px}
    .site-title .tag{font-size:11px}
  }
  @media(max-width:480px){
    .gallery-grid{grid-template-columns:1fr}
    .hero img{height:160px}
    .logo{height:44px}
    .container{padding:10px}
    .topbar{gap:8px}
    .search input{padding:8px}
    .btn{padding:10px}
    .site-title{display:none}
  }

  /* small helpers */
  .narrow{text-align:left;max-width:860px;margin:0 auto}
</style>
</head>
<body>

<header>
  <div class="container topbar" id="headerTop">
    <button id="hamburgerBtn" class="hamburger" aria-label="Toggle sidebar">☰</button>

    <img id="siteLogo" src="assets/images/hero/logo.jpg" alt="XI-JUDGES logo" class="logo">

    <div class="site-title" aria-hidden="false">
      <div class="name">XI-JUDGES STEM</div>
      <div class="tag">Official site — for school purposes only</div>
    </div>

    <div class="header-actions">
      <!-- mobile toggle (shows header nav) -->
      <button id="mobileToggle" class="mobile-toggle" aria-label="Open menu" aria-expanded="false" title="Menu">
        <!-- simple minimal icon -->
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="5" width="18" height="2" rx="1" fill="currentColor"/><rect x="3" y="11" width="18" height="2" rx="1" fill="currentColor" opacity="0.8"/><rect x="3" y="17" width="18" height="2" rx="1" fill="currentColor" opacity="0.6"/></svg>
      </button>

      <nav aria-label="Main navigation" id="topNav">
        <ul>
          <li><a href="#home">Home</a></li>
          <li><a href="#about">About</a></li>
          <li><a href="#subjects">Subjects</a></li>
          <li><a href="#gallery">Gallery</a></li>
          <li><a href="#downloads">Downloads</a></li>
          <li><a href="#contact">Contact Us</a></li>
        </ul>
      </nav>
    </div>
  </div>

  <!-- mobile header nav area (replaces mobile search) -->
  <div id="mobileNav" class="mobile-nav" aria-hidden="true">
    <div class="links container">
      <a href="#home">Home</a>
      <a href="#about">About</a>
      <a href="#subjects">Subjects</a>
      <a href="#gallery">Gallery</a>
      <a href="#downloads">Downloads</a>
      <a href="#contact">Contact Us</a>
      <a href="#more">More</a>
    </div>
  </div>
</header>

<main class="container">
  <div class="layout">
    <aside class="sidebar" aria-labelledby="note">
      <h4 id="note">NOTE</h4>
      <p style="margin-bottom:10px">This website is an Emptech project made by a group of students under Ma'am Katz Escano.</p>

      <div style="margin-top:6px">
        <div class="muted" style="font-size:13px">Search lessons</div>
        <div class="search" role="search">
          <input id="searchInput" placeholder="search lesson, subject, or tag..." aria-label="Search lessons">
          <button id="searchBtn" type="button" aria-label="Search">Search</button>
        </div>
      </div>
    </aside>

    <section id="mainContent">
      <div class="breadcrumbs" id="breadcrumbs">Home</div>

      <!-- HOME -->
      <div id="page-home">
        <div class="hero" id="hero">
          <img id="heroImg" src="assets/images/hero/gallery1.jpg" alt="hero image">
        </div>

        <h2 style="margin:18px 0 8px 0">Subjects Overview</h2>
        <p style="margin:0 0 12px 0;color:var(--muted)">STEM subjects are grouped into Core, Applied, and Specialized categories. Click a subject to open its lessons.</p>

        <div class="home-cats" id="homeCats" aria-live="polite"></div>
      </div>

      <!-- ABOUT -->
      <div id="page-about" style="display:none">
        <h1>About</h1>
        <div class="narrow">
          <p>This website is designed to guide/help STEM students or anyone who is interested in learning STEM subjects. You will find lessons, reviewers, summaries, videos, and resources to make studying easier.</p>
        </div>
      </div>

      <!-- SUBJECTS (lesson list and subject list) -->
      <div id="page-subjects" style="display:none">
        <h1 id="subjectTitle">Subjects</h1>
        <div id="subjectDesc" style="color:var(--muted);margin-bottom:12px"></div>

        <div id="subjectsList" class="subjects-grid"></div>
        <div id="lessonsList" class="subjects-grid" style="margin-top:12px;display:none"></div>
      </div>

      <!-- GALLERY -->
      <div id="page-gallery" style="display:none">
        <h1>Gallery</h1>
        <div class="gallery-grid" id="galleryGrid"></div>
      </div>

      <!-- DOWNLOADS -->
      <div id="page-downloads" style="display:none">
        <h1>Downloads / Resources</h1>
        <div id="downloadsList" class="resources"></div>
      </div>

      <!-- CONTACT -->
      <div id="page-contact" style="display:none">
        <h1>Contact Us</h1>
        <div class="narrow">
          <p>Got any questions? Reach out.</p>
          <div style="margin-top:8px">
            <p style="margin:0 0 8px 0">Email address: <strong>xijudges@gmail.com</strong></p>
            <a class="btn" href="mailto:xijudges@gmail.com" aria-label="Email XI-JUDGES">Email Us</a>

            <div class="social-row" role="list" aria-label="Social links" style="margin-top:12px">
              <a role="listitem" class="social-btn social-fb" href="https://www.facebook.com/profile.php?id=61578623245383" target="_blank" rel="noopener" aria-label="XI-JUDGES on Facebook">
                <span class="icon" aria-hidden="true" style="background:transparent;display:inline-flex">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 12.07C22 6.48 17.52 2 11.93 2S2 6.48 2 12.07c0 4.99 3.66 9.13 8.44 9.93v-7.03H7.9v-2.9h2.54V9.84c0-2.5 1.49-3.88 3.77-3.88 1.09 0 2.23.2 2.23.2v2.45h-1.25c-1.23 0-1.61.77-1.61 1.56v1.87h2.74l-.44 2.9h-2.3V22c4.78-.8 8.44-4.94 8.44-9.93z" fill="#fff"/></svg>
                </span>
                <span>Facebook</span>
              </a>

              <a role="listitem" class="social-btn social-ig" href="https://www.instagram.com/xi_judges" target="_blank" rel="noopener" aria-label="XI-JUDGES on Instagram">
                <span class="icon" aria-hidden="true" style="background:transparent;display:inline-flex">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zM12 8.5A3.5 3.5 0 1 0 15.5 12 3.5 3.5 0 0 0 12 8.5zM17.5 5a1 1 0 1 0 1 1 1 1 0 0 0-1-1z" fill="#fff"/></svg>
                </span>
                <span>Instagram</span>
              </a>

              <a role="listitem" class="social-btn social-mail" href="mailto:xijudges@gmail.com" aria-label="Email XI-JUDGES">
                <span class="icon" aria-hidden="true" style="background:transparent;display:inline-flex">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zm0 4l-8 5-8-5V6l8 5 8-5z" fill="currentColor"/></svg>
                </span>
                <span>Email Us</span>
              </a>
            </div>

            <p style="margin-top:12px;color:var(--muted);font-size:14px">Don't forget to follow our socials</p>
          </div>
        </div>
      </div>

      <!-- LESSON -->
      <div id="page-lesson" style="display:none">
        <div class="lesson" id="lessonView">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
            <div>
              <h1 id="lessonTitle"></h1>
              <div class="meta" id="lessonMeta"></div>
            </div>
          </div>

          <div style="margin-top:14px" id="lessonSummary"></div>
          <div class="resources" id="lessonResources"></div>
          <div id="videoContainer"></div>
        </div>
      </div>

    </section>
  </div>
</main>

<footer>
  <div class="footer-grid" role="contentinfo" aria-label="Footer">
    <div class="footer-col-left" style="display:flex;align-items:center;justify-content:center">
      <div class="footer-logo" aria-hidden="true">
        <img id="footerLogoImg" src="assets/images/hero/logo.jpg" alt="XI-JUDGES logo">
      </div>
    </div>

    <div class="footer-col-center">
      <nav class="footer-nav" aria-label="Footer navigation">
        <a href="#home">Home</a>
        <a href="#about">About</a>
        <a href="#subjects">Subjects</a>
        <a href="#gallery">Gallery</a>
        <a href="#downloads">Downloads</a>
        <a href="#contact">Contact</a>
      </nav>
      <div class="footer-small" style="margin-top:8px">
        <strong>XI-JUDGES STEM</strong> — For school purposes only. Not for commercial use.
      </div>
    </div>

    <div class="footer-col-right footer-contact">
      <div class="contact-row">
        <a class="btn btn-outline" href="mailto:xijudges@gmail.com" aria-label="Email XI-JUDGES">xijudges@gmail.com</a>
      </div>
      <div class="contact-row" style="font-size:13px;color:var(--muted)">
        <span>© 2025 XI-JUDGES STEM</span>
      </div>
    </div>
  </div>
</footer>

<!-- Modal -->
<div id="modalBackdrop" class="modal-backdrop" aria-hidden="true" role="dialog" aria-label="Image preview">
  <button id="modalClose" aria-label="Close">✕</button>
  <img id="modalImage" class="modal-img" alt="Preview">
</div>

<script>
/* ---------- FULL SITE_DATA (restored full lesson lists) ---------- */
/* The dataset is identical to what you provided so no lessons are omitted. */
const SITE_DATA = {
  siteName: 'XI-JUDGES STEM',
  homeSlides:[
    'assets/images/hero/gallery1.jpg',
    'assets/images/gallery2.jpg',
    'assets/images/gallery3.jpg'
  ],
  subjects:[
    {
      id:'emptech',
      title:'Empowerment Technologies',
      short:'Applied ICT skills and content development.',
      lessons:[
        {title:'Introduction to ICT', slug:'emptech-intro-ict', summary:'Overview of ICT and its role.', youtube:['https://youtu.be/4hzcT6tMf-M?si=nVxDbXj9BTp6MHcx']},
        {title:'Rules of Netiquette', slug:'emptech-netiquette', summary:'Netiquette and online behavior.', youtube:['https://youtu.be/GXb48ztCGvI?si=7DpaVLpLZkezxC0v']},
        {title:'Advanced Word Processing', slug:'emptech-word', summary:'Word processing advanced features.', youtube:['https://youtu.be/Du8VFmfd-lc?si=bYHuSOEJuL_rp3uz']},
        {title:'Advanced Spreadsheet skills', slug:'emptech-spreadsheet', summary:'Spreadsheets for data & formulas.', youtube:['https://youtu.be/lKh_Waz8Bek?si=jsDEVnHe8HkzIZHj']},
        {title:'Advanced Presentation skills', slug:'emptech-presentation', summary:'Creating effective presentations.', youtube:['https://youtu.be/W2VZjwLzQmg?si=vJD3URpfV27ClxOy']},
        {title:'Imaging and Designing for online environment', slug:'emptech-imaging', summary:'Basics of imaging & design for web.', youtube:['https://youtu.be/AiiSGGfPQTY?si=K7CeIZmfzfEI_rEj']},
        {title:'Online platforms for ICT content development', slug:'emptech-platforms', summary:'Platforms for publishing and collaboration.', youtube:['https://youtu.be/Y-t-DLhZhw4?si=cfplIG_mtARwIfR8']},
        {title:'Basic Web Page creating', slug:'emptech-webpage', summary:'Introduction to making webpages.', youtube:['https://youtu.be/fhgCZHyYz7U?si=hjrTNwpQOgb4aIfi']},
        {title:'Collaborative ICT Development', slug:'emptech-collab', summary:'Working together on ICT projects.', youtube:['https://youtu.be/L-Ktk0xIrgw?si=diVuV_VXfoGnNKjz']},
        {title:'Interactive Multimedia', slug:'emptech-multimedia', summary:'Multimedia elements and interactivity.', youtube:['https://youtu.be/cjtvKbl9Qug?si=CDbnKtYhTpwNLsuA']},
        {title:'ICT as an agent of change', slug:'emptech-agent', summary:'ICT impacts society and change.', youtube:['https://youtu.be/Cfk4Z9AjpbU?si=wr2SU7eVfDkWurC6']},
        {title:'ICT project for social change', slug:'emptech-project', summary:'Designing ICT projects for community benefit.', youtube:['https://youtu.be/KoITSQnq2-E?si=zIhnCb4FIpzUSlWm']}
      ]
    },
    {
      id:'genbio',
      title:'General Biology 1',
      short:'Cell biology, tissues, mitosis & meiosis, evolution.',
      lessons:[
        {title:'Cell Theory', slug:'bio-cell-theory', summary:'Foundational cell theory concepts.', youtube:['https://youtu.be/iu8iqT7lUQc?si=8mtDpm7tNdFupTJy'], readingLinks:['https://codental.uobaghdad.edu.iq/wp-content/uploads/sites/14/2020/03/Cell-Theory.pdf']},
        {title:'Organelle Structure & Function', slug:'bio-organelles', summary:'Major organelles and roles.', youtube:['https://youtu.be/56kSOHc8B1E?si=OBbw6oWIueIw_3nl'], readingLinks:['https://byjus.com/biology/cells/','https://www.genome.gov/genetics-glossary/Organelle']},
        {title:'Cell Structure & Functions', slug:'bio-cell-structure', summary:'Cell components and their functions.', youtube:['https://youtu.be/6mgkoqcm6Sg?si=fE_ZcT-3mh04a2ly','https://youtu.be/t5DvF5OVr1Y?si=RejdDjqfqL4InY-D'], readingLinks:['https://www.mugberiagangadharmahavidyalaya.ac.in/images/ques_answer/1585930984BD%20Cell%20Unit%20-%201.2.pdf']},
        {title:'Animal Tissues', slug:'bio-animal-tissues', summary:'Types and functions of animal tissues.', youtube:['https://youtu.be/UlINGF9MnNA?si=LO3gc1LMkOftBbdU','https://youtu.be/OU_hmL-XxYI?si=YhCfUKX78riJyArs'], readingLinks:['https://byjus.com/biology/animal-tissue-types/','https://study.com/academy/lesson/animal-tissues-types-structure-function.html']},
        {title:'Plant Tissues', slug:'bio-plant-tissues', summary:'Plant tissue systems and roles.', youtube:['https://youtu.be/M-qDzKG3RB0?si=73y-xa2wdAF9Yx_f','https://youtu.be/A_DF246uVlU?si=I0hWkTTeqDHulYMd','https://youtu.be/gms6BrFl6mc?si=ZHNSRR5CCdtR2jcI'], readingLinks:['https://byjus.com/biology/plant-tissue-system/','https://courses.lumenlearning.com/wm-biology2/chapter/plant-tissues-and-organs/']},
        {title:'Cell Modification', slug:'bio-cell-modification', summary:'Structural modifications of cells.', youtube:['https://youtu.be/t3g26p9Mh_k?si=W5fZ1c7RQn7U2Ctq','https://youtu.be/nJ43FkoabXw?si=mLi8SyG870KSj8pY','https://youtu.be/Pvton7y5mCw?si=LNR7GMXz2nAbdOEB'], readingLinks:['https://www.slideshare.net/slideshow/lesson-4-cell-modifications/185713646']},
        {title:'Mitosis and Meiosis', slug:'bio-mitosis-meiosis', summary:'Cell division processes and stages.', youtube:['https://youtu.be/zrKdz93WlVk?si=wsUhzzclZCrL_uj0','https://youtu.be/f-ldPgEfAHI?si=59XBm17L7yvR97Rs','https://youtu.be/VzDMG7ke69g?si=qyr505K_DWMtyv-R'], readingLinks:['https://byjus.com/biology/mitosis-and-meiosis/']},
        {title:'Evolutionary Processes', slug:'bio-evolution', summary:'Mechanisms that drive evolution.', youtube:['https://youtu.be/fI7IV3x-dGI?si=S3Eo-M2P08nhr59i','https://youtu.be/gQ4hJDwllO0?si=ObwzLKGLleeyPSTr'], readingLinks:['https://bio.libretexts.org/Bookshelves/Introductory_and_General_Biology/General_Biology_1e_(OpenStax)/4%3A_Evolutionary_Processes','https://evolution.berkeley.edu/evolution-101/mechanisms-the-processes-of-evolution/']},
        {title:'Applications of Mitosis/Meiosis', slug:'bio-mitosis-app', summary:'Applications in medicine and breeding.', youtube:['https://youtu.be/56kSOHc8B1E?si=OBbw6oWIueIw_3nl']},
        {title:'Cell-cycle Disorders & Diseases', slug:'bio-cell-disorders', summary:'Diseases related to cell-cycle errors.', youtube:['https://youtu.be/dODIrlEN55g?si=8UKmfI1C5yi8_cfL','https://youtu.be/NnbkWU63toI?si=WyCsRGbTxLOWu14H','https://youtu.be/bXNQmxEvpWw?si=B1bk7LfveiUm2b_D']},
        {title:'Cell Membrane', slug:'bio-cell-membrane', summary:'Structure and function of the membrane.', youtube:['https://youtu.be/fJfTDc3WzQ8?si=Z70mBf6sC-ItDR3K']},
        {title:'Transport Mechanisms', slug:'bio-transport', summary:'Diffusion, osmosis, active transport.', youtube:['https://youtu.be/ufCiGz75DAk?si=EaxfT6AG1dxcccP7','https://youtu.be/r1Ug-UvDns0?si=jaG7HCSuudl7MEm_']},
        {title:'Enzymes', slug:'bio-enzymes', summary:'Enzyme structure, function, kinetics.', youtube:['https://youtu.be/qgVFkRn8f10?si=5hjDJuc5JfZ3Zacc']}
      ]
    },
    {
      id:'precalc',
      title:'Pre-Calculus',
      short:'Conic sections and transformations.',
      lessons:[
        {title:'Introduction to Conic Sections', slug:'precalc-conics', summary:'Overview of circles, parabolas, ellipses, hyperbolas.', youtube:['https://youtu.be/0A7RR0oy2ho?si=aVhIG6TTo7084MOC']},
        {title:'Equation of a Circle (standard)', slug:'precalc-circle-std', summary:'Equation & properties', youtube:['https://youtu.be/6r1GQCxyMKI?si=EJ7ad42B_Fo1ax6Q']},
        {title:'Transforming standard → general (circle)', slug:'precalc-circle-transform', summary:'Algebraic transformation of circle equations.', youtube:['https://youtu.be/Z-e7fcVjTiU?si=v_UiuN2agj7QwH2i']},
        {title:'Parabola (vertex at origin)', slug:'precalc-parabola-origin', summary:'Parabola properties when vertex at origin.', youtube:['https://youtube.com/shorts/JJnvxUV049A?si=NNQnuw4bRXXxYRSM']},
        {title:'Finding Parabola equation', slug:'precalc-parabola-eq', summary:'Deriving a parabola equation from points.', youtube:['https://youtu.be/KYgmOTLbuqE?si=ZsVER0esUi-fPDl8']},
        {title:'Ellipse standard equation (origin)', slug:'precalc-ellipse-origin', summary:'Ellipse geometry & standard form.', youtube:['https://youtu.be/PpMZ6RHPeTA?si=JBJ5JUut-nwkmXgi']}
      ]
    },
    {
      id:'rws',
      title:'Reading & Writing Skills',
      short:'Language skills and text analysis.',
      lessons:[
        {title:'Basic Language Skills', slug:'rws-basic', summary:'Grammar, vocabulary & usage.', youtube:['https://youtu.be/GJZmUA4MrLQ']},
        {title:'Patterns of Development', slug:'rws-patterns', summary:'Organizing paragraphs & essays.', youtube:['https://youtu.be/GtfGnzFYN_s?si=J2xw6B5HN6AnP-Qq']},
        {title:'Properties of a Well-Written Text', slug:'rws-properties', summary:'Criteria for good writing.', youtube:['https://youtu.be/sL6c8nePZTQ?si=8c7K367i_CPPzsSK']},
        {title:'Explicit & Implicit Claims', slug:'rws-claims', summary:'Identifying claims in texts.', youtube:['https://youtu.be/JtuhemMlmzk?si=0N5lEWhrfI63rrCX']}
      ]
    },
    {
      id:'eapp',
      title:'English for Academic & Professional Purposes (EAPP)',
      short:'Academic writing and presentations.',
      lessons:[
        {title:'Language in academic texts', slug:'eapp-language', summary:'Register and features of academic language.', youtube:['https://youtu.be/g-SRMHvaurA']},
        {title:'Thesis Statement', slug:'eapp-thesis', summary:'Crafting clear thesis statements.', youtube:['https://youtu.be/yK2VckxsaGM']},
        {title:'Outlining reading texts', slug:'eapp-outlining', summary:'Effective outlining techniques.', youtube:['https://youtu.be/mPCCN6K8Gjc']}
      ]
    },
    {
      id:'genchem',
      title:'General Chemistry 1',
      short:'Properties, substances and gas laws.',
      lessons:[
        {title:'Properties of Matter', slug:'chem-properties', summary:'States and properties of matter.', youtube:['https://youtu.be/VJ3b08L-0SQ']},
        {title:'Common Chemical Substances', slug:'chem-common', summary:'Examples and uses of common chemicals.', youtube:['https://youtu.be/TR2iR3CZLcw']},
        {title:'Separation Methods', slug:'chem-separation', summary:'Filtration, distillation, chromatography.', youtube:['https://youtu.be/qpZhc2Zn_TI']},
        {title:'Isotopes', slug:'chem-isotopes', summary:'Isotopes and atomic mass.', youtube:['https://youtu.be/bagegEZBtOs']},
        {title:'Gas Laws', slug:'chem-gaslaws', summary:'Boyle, Charles, combined gas laws.', youtube:['https://youtu.be/W2g2iP83JoI']}
      ]
    },
    {
      id:'kompan',
      title:'Komunikasyon at Pananaliksik sa Wika',
      short:'Filipino communication and research.',
      lessons:[
        {title:'Wika: Kahulugan at Kabuluhan', slug:'kompan-wika', summary:'Meaning and importance of language.', youtube:['https://youtu.be/uDIyH89_heY?si=SaSlEjCIRGm0vjrt']},
        {title:'Konseptong Pangwika', slug:'kompan-konsepto', summary:'Key concepts in linguistics.', youtube:['https://youtu.be/0iBG4rAMapU?si=jrjb3Op_oX4M0kDe']}
      ]
    },
    {
      id:'genmath',
      title:'General Mathematics',
      short:'Functions, rational functions, inequalities.',
      lessons:[
        {title:'Functions', slug:'gm-functions', summary:'Definition and types of functions.', youtube:['https://youtu.be/-Pr3NoB9S9k']},
        {title:'Evaluating Functions', slug:'gm-evaluate', summary:'Plugging values and interpreting.', youtube:['https://youtu.be/9lmKVSFdMHE']},
        {title:'Operation on Functions', slug:'gm-ops', summary:'Combining and composing functions.', youtube:['https://youtu.be/0Dy2H6kv_3g']}
      ]
    },
    {
      id:'hope',
      title:'HOPE',
      short:'Health-oriented PE and fitness.',
      lessons:[
        {title:'The Healthiest and Fittest Me', slug:'hope-fit', summary:'Personal fitness and wellness planning.', youtube:[]},
        {title:'Set Fitness Goal', slug:'hope-goal', summary:'SMART goals for fitness.', youtube:[]}
      ]
    }
  ]
};

/* ---------- helpers ---------- */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
function esc(s){ return String(s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
function placeholderDataUrl(text){ text = text || 'Image not found'; return 'data:image/svg+xml;utf8,' + encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='1200' height='675'><rect fill='#f5f4ff' width='100%' height='100%'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='#7a6fb8' font-family='Poppins,Arial' font-size='28'>${text}</text></svg>`); }
function trySourcesOnce(imgEl, sources, fallback){
  if(!imgEl) return;
  if(!Array.isArray(sources) || sources.length === 0){ imgEl.src = fallback || placeholderDataUrl(); return; }
  let i = 0;
  imgEl.onerror = function(){
    i++;
    if(i < sources.length){
      imgEl.onerror = function(){ i++; if(i < sources.length) imgEl.src = sources[i]; else imgEl.src = fallback || placeholderDataUrl(); };
      imgEl.src = sources[i];
    } else {
      imgEl.src = fallback || placeholderDataUrl();
    }
  };
  imgEl.src = sources[0];
}

/* ---------- renderers ---------- */
const SUBJECT_CATEGORIES = {
  "Core Subjects": ['rws','kompan','genmath','hope'],
  "Applied Subjects": ['emptech','eapp'],
  "Specialized Subjects": ['precalc','genbio','genchem']
};

function renderHomeCategories(){
  const container = $('#homeCats'); if(!container) return;
  container.innerHTML = '';
  Object.keys(SUBJECT_CATEGORIES).forEach(catName=>{
    const ids = SUBJECT_CATEGORIES[catName];
    const card = document.createElement('div'); card.className = 'cat-card';
    const inner = document.createElement('div');
    inner.innerHTML = `<h3>${esc(catName)}</h3>`;
    const ul = document.createElement('ul'); ul.className = 'cat-list';
    if(!ids || ids.length === 0){
      const li = document.createElement('li'); li.textContent = 'No subjects listed.';
      ul.appendChild(li);
    } else {
      ids.forEach(id=>{
        const subj = (SITE_DATA.subjects||[]).find(s=>s.id===id);
        const li = document.createElement('li');
        if(subj){
          li.innerHTML = `<a href="#subject/${subj.id}">${esc(subj.title)}</a> <span style="color:var(--muted);font-size:13px"> — ${esc(subj.short || '')}</span>`;
        } else {
          li.textContent = id + ' (missing)';
        }
        ul.appendChild(li);
      });
    }
    inner.appendChild(ul);
    card.appendChild(inner);
    container.appendChild(card);
  });
}

function renderSubjectsList(){
  const container = $('#subjectsList'); if(!container) return;
  container.innerHTML = '';
  (SITE_DATA.subjects || []).forEach(sub=>{
    const card = document.createElement('div'); card.className = 'subject-card';
    card.innerHTML = `<div><h3>${esc(sub.title)}</h3><p class="muted">${esc(sub.short || '')}</p></div><div style="margin-top:12px"><a href="#subject/${sub.id}" class="btn">Open</a></div>`;
    container.appendChild(card);
  });
}

function renderGallery(){
  const g = $('#galleryGrid'); if(!g) return; g.innerHTML='';
  const images = SITE_DATA.homeSlides && SITE_DATA.homeSlides.length ? SITE_DATA.homeSlides : [];
  images.forEach((src,i)=>{
    const d = document.createElement('div'); d.className='thumb';
    const img = document.createElement('img'); img.alt = `gallery ${i+1}`;
    const basename = src.split('/').pop();
    const candidates = [src, `assets/images/hero/${basename}`, `assets/images/${basename}`, `assets/${basename}`].filter(Boolean);
    trySourcesOnce(img, candidates, placeholderDataUrl());
    d.appendChild(img);
    d.addEventListener('click', ()=> openModal(img.src || src));
    g.appendChild(d);
  });
}

function renderDownloads(){
  const container = $('#downloadsList'); if(!container) return; container.innerHTML='';
  (SITE_DATA.subjects || []).forEach(sub=>{
    const sec = document.createElement('section'); sec.style.marginBottom='18px';
    const h = document.createElement('h3'); h.textContent = sub.title; sec.appendChild(h);
    (sub.lessons || []).forEach(lesson=>{
      const row = document.createElement('div'); row.style.marginBottom='8px';
      const t = document.createElement('div'); t.innerHTML = `<strong>${esc(lesson.title)}</strong>`; row.appendChild(t);
      if(Array.isArray(lesson.youtube)) lesson.youtube.forEach(u=>{
        const a = document.createElement('a'); a.href = u; a.target='_blank'; a.rel='noopener'; a.className='btn'; a.style.margin='6px 8px 6px 0'; a.textContent='YouTube'; row.appendChild(a);
      });
      if(Array.isArray(lesson.readingLinks)) lesson.readingLinks.forEach(r=>{
        const a = document.createElement('a'); a.href = r; a.target='_blank'; a.rel='noopener'; a.className='btn'; a.style.margin='6px 8px 6px 0'; a.textContent='Reading'; row.appendChild(a);
      });
      sec.appendChild(row);
    });
    container.appendChild(sec);
  });
}

/* modal */
const modalBackdrop = $('#modalBackdrop');
const modalImage = $('#modalImage');
$('#modalClose').addEventListener('click', ()=> closeModal());
modalBackdrop.addEventListener('click', (e)=> { if(e.target === modalBackdrop) closeModal(); });
function openModal(src){
  const basename = src.split('/').pop();
  const candidates = [src, `assets/images/hero/${basename}`, `assets/images/${basename}`, `assets/${basename}`].filter(Boolean);
  trySourcesOnce(modalImage, candidates, placeholderDataUrl('Preview not found'));
  modalBackdrop.classList.add('active'); modalBackdrop.setAttribute('aria-hidden','false');
}
function closeModal(){ modalBackdrop.classList.remove('active'); modalBackdrop.setAttribute('aria-hidden','true'); modalImage.src = ''; }

/* ---------- routing & search ---------- */
function setBreadcrumb(parts){ const el = $('#breadcrumbs'); if(el) el.textContent = parts.join(' > '); }
function showOnly(id){
  const pages = ['page-home','page-about','page-subjects','page-gallery','page-downloads','page-contact','page-lesson'];
  pages.forEach(p=>{ const el=document.getElementById(p); if(!el) return; el.style.display = (p===id)?'block':'none'; });
  window.scrollTo({top:0,behavior:'smooth'});
}
function showHome(){ showOnly('page-home'); setBreadcrumb(['Home']); renderHomeCategories(); }
function showAbout(){ showOnly('page-about'); setBreadcrumb(['About']); }
function showGallery(){ showOnly('page-gallery'); setBreadcrumb(['Gallery']); renderGallery(); }
function showDownloads(){ showOnly('page-downloads'); setBreadcrumb(['Downloads']); renderDownloads(); }
function showContact(){ showOnly('page-contact'); setBreadcrumb(['Contact Us']); }

/* Subjects */
function showSubjectsList(){
  showOnly('page-subjects');
  setBreadcrumb(['Subjects']);
  $('#subjectTitle').textContent = 'Subjects';
  $('#subjectDesc').textContent = 'All available subjects. Click Open to view lessons.';
  $('#subjectsList').style.display = 'grid';
  $('#lessonsList').style.display = 'none';
  renderSubjectsList();
}
function showSubject(subjectId){
  const subj = (SITE_DATA.subjects||[]).find(s=>s.id===subjectId);
  if(!subj){ showSubjectsList(); return; }
  showOnly('page-subjects'); setBreadcrumb(['Subjects', subj.title]);
  $('#subjectTitle').textContent = subj.title;
  $('#subjectDesc').textContent = subj.short || '';
  $('#subjectsList').style.display = 'none';
  $('#lessonsList').style.display = 'grid';
  const list = $('#lessonsList'); list.innerHTML = '';
  (subj.lessons || []).forEach(lesson=>{
    const c = document.createElement('div'); c.className='subject-card';
    c.innerHTML = `<div><h3>${esc(lesson.title)}</h3><p class="muted">${esc(lesson.summary || '')}</p></div><div style="margin-top:12px"><a class="btn" href="#lesson/${subj.id}/${lesson.slug}">Open lesson</a></div>`;
    list.appendChild(c);
  });
}
function showLesson(subjectId, lessonSlug){
  const subj = (SITE_DATA.subjects||[]).find(s=>s.id===subjectId); if(!subj) return showSubjectsList();
  const lesson = (subj.lessons||[]).find(l=>l.slug===lessonSlug); if(!lesson) return showSubject(subjectId);
  showOnly('page-lesson'); setBreadcrumb(['Subjects',subj.title, lesson.title]);
  $('#lessonTitle').textContent = lesson.title;
  $('#lessonMeta').innerHTML = `<span class="muted">Subject: ${esc(subj.title)}</span>`;
  $('#lessonSummary').textContent = lesson.summary || '';
  const res = $('#lessonResources'); if(res) res.innerHTML = '';
  if(Array.isArray(lesson.readingLinks)) lesson.readingLinks.forEach(link=>{
    const a = document.createElement('a'); a.href = link; a.target='_blank'; a.rel='noopener'; a.className='btn'; a.textContent='Reading'; a.style.marginRight='8px'; res.appendChild(a);
  });
  if(lesson.pdfFilename){ const a=document.createElement('a'); a.href='assets/pdfs/'+lesson.pdfFilename; a.className='btn'; a.textContent='Download PDF'; res.appendChild(a); }
  const vc = $('#videoContainer'); if(vc) vc.innerHTML='';
  if(Array.isArray(lesson.youtube) && lesson.youtube.length){
    lesson.youtube.forEach(url=>{
      const id = (function(u){ try{ if(!u) return null; if(!u.startsWith('http') && /^[A-Za-z0-9_-]{8,}$/.test(u)) return u; const parsed = new URL(u); if(parsed.hostname.includes('youtu.be')) return parsed.pathname.slice(1).split(/[?&#]/)[0]; if(parsed.hostname.includes('youtube.com')){ if(parsed.searchParams.get('v')) return parsed.searchParams.get('v').split(/[?&]/)[0]; if(parsed.pathname.includes('/embed/')) return parsed.pathname.split('/embed/')[1].split(/[?&#]/)[0]; if(parsed.pathname.startsWith('/shorts/')) return parsed.pathname.split('/shorts/')[1].split(/[?&#]/)[0]; } }catch(e){} const m = String(u).match(/(?:v=|\/embed\/|youtu\.be\/|\/shorts\/)([A-Za-z0-9_-]{6,})/); return m?m[1]:null; })(url);
      if(!id) return;
      const wrap = document.createElement('div'); wrap.className = 'video-wrap';
      const iframe = document.createElement('iframe'); iframe.src = `https://www.youtube.com/embed/${id}`; iframe.title='YouTube video'; iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"; iframe.allowFullscreen=true;
      wrap.appendChild(iframe); vc.appendChild(wrap);
    });
  }
}

/* search */
function doSearch(){
  const qSidebar = ($('#searchInput') && $('#searchInput').value || '').trim();
  const q = (qSidebar || '').trim().toLowerCase();
  if(!q){ alert('Type a search term'); return; }
  for(const s of (SITE_DATA.subjects||[])){
    if(s.title && s.title.toLowerCase().includes(q)){ location.hash = `#subject/${s.id}`; return; }
    for(const l of (s.lessons||[])){
      if((l.title && l.title.toLowerCase().includes(q)) || (l.summary && l.summary.toLowerCase().includes(q))){
        location.hash = `#lesson/${s.id}/${l.slug}`; return;
      }
    }
  }
  alert('No results found');
}

/* router */
function handleHash(){
  const raw = (location.hash || '').replace(/^#/,'');
  if(!raw || raw==='home'){ showHome(); return; }
  const parts = raw.split('/').map(p=>decodeURIComponent((p||'').trim())).filter(Boolean);
  if(parts.length===0){ showHome(); return; }
  const head = parts[0].toLowerCase();
  if(head==='about') return showAbout();
  if(head==='gallery') return showGallery();
  if(head==='downloads') return showDownloads();
  if(head==='contact') return showContact();
  if(head==='subjects') return showSubjectsList();
  if(head==='subject' && parts[1]) return showSubject(parts[1]);
  if(head==='lesson' && parts[1] && parts[2]) return showLesson(parts[1], parts[2]);
  if((SITE_DATA.subjects||[]).some(s=>s.id===head)) return showSubject(head);
  showHome();
}

/* ---------- boot ---------- */
window.addEventListener('load', ()=>{
  // Load & fallback images
  trySourcesOnce(document.getElementById('siteLogo'), ['assets/images/hero/logo.jpg','assets/logo.jpg','assets/images/logo.jpg','assets/logo.png'], placeholderDataUrl('Logo not found'));
  trySourcesOnce(document.getElementById('footerLogoImg'), ['assets/images/hero/logo.jpg','assets/logo.jpg','assets/images/logo.jpg','assets/logo.png'], placeholderDataUrl('Logo not found'));
  trySourcesOnce(document.getElementById('heroImg'), SITE_DATA.homeSlides || ['assets/images/hero/gallery1.jpg'], placeholderDataUrl('Hero not found'));

  // Initial renderers
  renderHomeCategories();
  renderSubjectsList();
  renderGallery();
  renderDownloads();

  // Mobile toggle for header nav (replaces search behavior)
  const mobileToggle = document.getElementById('mobileToggle');
  const mobileNav = document.getElementById('mobileNav');
  function setMobileToggleVisibility(){
    if(window.innerWidth <= 900){ mobileToggle.style.display = 'inline-flex'; }
    else { mobileToggle.style.display = 'none'; mobileNav.classList.remove('open'); mobileNav.setAttribute('aria-hidden','true'); mobileToggle.setAttribute('aria-expanded','false'); }
  }
  setMobileToggleVisibility();
  window.addEventListener('resize', setMobileToggleVisibility);

  mobileToggle?.addEventListener('click', ()=>{
    const open = mobileNav.classList.contains('open');
    if(open){
      mobileNav.classList.remove('open'); mobileNav.setAttribute('aria-hidden','true'); mobileToggle.setAttribute('aria-expanded','false');
    } else {
      mobileNav.classList.add('open'); mobileNav.setAttribute('aria-hidden','false'); mobileToggle.setAttribute('aria-expanded','true');
      // close sidebar to avoid overlap
      document.body.classList.remove('sidebar-open');
    }
  });

  // hamburger toggle for sidebar
  const hamb = document.getElementById('hamburgerBtn');
  hamb?.addEventListener('click', ()=> {
    if(window.innerWidth <= 900){ document.body.classList.toggle('sidebar-open'); }
    else { document.body.classList.toggle('sidebar-hidden'); }
  });

  // Close mobile sidebar when clicking outside
  document.addEventListener('click', (e)=> {
    if(window.innerWidth <= 900 && document.body.classList.contains('sidebar-open')){
      const inside = e.target.closest('.sidebar') || e.target.closest('#hamburgerBtn');
      if(!inside) document.body.classList.remove('sidebar-open');
    }
  });

  // Universal link handler: intercept any internal hash anchor and route with router.
  document.body.addEventListener('click', (e)=>{
    const a = e.target.closest('a');
    if(!a) return;
    const href = a.getAttribute('href') || '';
    // allow external links and mailto/tel to function normally
    if(href.startsWith('mailto:') || href.startsWith('tel:') || href.startsWith('http://') || href.startsWith('https://')) return;
    if(href.startsWith('#')){
      e.preventDefault();
      const target = href.replace(/^#/,'');
      // update hash -> triggers hashchange
      location.hash = target;
      // close mobile header + sidebar for clean UX
      if(mobileNav){ mobileNav.classList.remove('open'); mobileNav.setAttribute('aria-hidden','true'); mobileToggle.setAttribute('aria-expanded','false'); }
      if(document.body.classList.contains('sidebar-open')) document.body.classList.remove('sidebar-open');
    }
  });

  // search bindings (sidebar)
  $('#searchBtn')?.addEventListener('click', (ev)=>{ ev.preventDefault(); doSearch(); });
  $('#searchInput')?.addEventListener('keydown', (ev)=>{ if(ev.key === 'Enter'){ ev.preventDefault(); doSearch(); } });

  // modal close when clicking outside already attached earlier

  // router wiring
  window.addEventListener('hashchange', handleHash);

  // initial routing after renderers
  handleHash();
});
</script>
</body>
</html>