<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>XI-JUDGES STEM — Official</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --purple:#5b3ea6;
    --purple-2:#6b4bd0;
    --cream:#f5eedf;
    --max-width:1200px;
    --gap:20px;
    --muted:#666;
    --footer-bg:#faf8ff;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;
    margin:0;color:#222;background:#fff;line-height:1.45;
    display:flex;
    flex-direction:column;
    min-height:100vh;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  /* header */
  header{
    background:#fff;
    border-bottom:1px solid rgba(0,0,0,0.06);
    position:sticky;top:0;z-index:60;
  }
  .container{max-width:var(--max-width);margin:0 auto;padding:18px}
  .topbar{display:flex;align-items:center;gap:12px}
  .logo{height:56px;width:auto;object-fit:contain}
  .hamburger{
    width:44px;height:44px;border-radius:8px;border:0;background:transparent;display:none;align-items:center;justify-content:center;cursor:pointer;font-size:20px;margin-right:6px;
  }
  nav{margin-left:auto}
  nav ul{display:flex;gap:14px;list-style:none;padding:0;margin:0;align-items:center}
  nav a{color:var(--purple);text-decoration:none;font-weight:600;cursor:pointer;padding:6px 8px}
  nav a:hover{text-decoration:underline}

  /* main should expand so footer is pushed to bottom when content short */
  main.container{flex:1}

  /* layout */
  .layout{display:grid;grid-template-columns:260px 1fr;gap:var(--gap);align-items:start;padding:24px}
  body.sidebar-hidden .layout{grid-template-columns:1fr}
  @media(max-width:900px){.layout{grid-template-columns:1fr;padding:12px}}

  /* sidebar */
  .sidebar{background:linear-gradient(180deg, rgba(91,62,166,0.02), transparent);padding:16px;border-radius:8px;transition:transform .18s ease,opacity .18s}
  .sidebar h4{margin:0 0 8px 0;color:var(--purple)}
  .sidebar p{margin:0;color:var(--muted)}
  @media(max-width:900px){
    .sidebar{position:fixed;left:0;top:72px;height:calc(100vh - 72px);width:80%;max-width:360px;z-index:120;box-shadow:0 20px 40px rgba(0,0,0,0.14);transform:translateX(-120%);opacity:0}
    body.sidebar-open .sidebar{transform:translateX(0);opacity:1}
    .hamburger{display:flex}
    nav ul{display:none} /* hide top nav on small screens; use sidebar */
  }
  body.sidebar-hidden .sidebar{display:none}

  .breadcrumbs{font-size:13px;color:var(--muted);margin-bottom:12px}

  /* hero (landscape look) */
  .hero{position:relative;border-radius:10px;overflow:hidden;background:#222;color:#fff}
  .hero img{width:100%;height:420px;object-fit:cover;display:block;user-select:none}
  @media(max-width:900px){ .hero img{height:220px} }
  @media(max-width:480px){ .hero img{height:180px} }

  /* home categories (3-column cards) */
  .home-cats{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:18px;margin-top:18px}
  .cat-card{background:var(--cream);padding:18px;border-radius:10px;box-shadow:0 6px 18px rgba(16,12,40,0.04)}
  .cat-card h3{margin:0 0 8px 0;color:var(--purple)}
  .cat-list{margin:8px 0 0 0;padding:0;list-style:none}
  .cat-list li{margin:6px 0}
  .cat-list a{color:var(--purple);text-decoration:none;font-weight:600}
  .cat-list a:hover{text-decoration:underline}

  /* grids */
  .subjects-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px}
  .subject-card{background:var(--cream);padding:12px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.04);display:flex;flex-direction:column;justify-content:space-between;min-height:120px}
  .subject-card h3{margin:0 0 8px 0;color:var(--purple);font-size:18px}
  .gallery-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px}
  .thumb{width:100%;aspect-ratio:16/9;background:#ddd;border-radius:6px;overflow:hidden;cursor:pointer}
  .thumb img{width:100%;height:100%;object-fit:cover;display:block}

  /* lesson */
  .lesson{background:#fff;padding:18px;border-radius:8px}
  .lesson h1{margin:0 0 8px 0}
  .meta{color:var(--muted);font-size:14px;margin-bottom:12px}
  .resources{display:flex;flex-direction:column;gap:8px;margin-top:12px}
  .btn{display:inline-block;padding:10px 12px;border-radius:6px;text-decoration:none;background:var(--purple);color:#fff;font-weight:600;border:0}

  /* responsive video wrapper */
  .video-wrap{position:relative;width:100%;padding-top:56.25%;margin-top:12px;border-radius:8px;overflow:hidden;background:#000}
  .video-wrap iframe{position:absolute;top:0;left:0;width:100%;height:100%;border:0}

  /* email button (outline variant) */
  .btn-outline{background:#fff;color:var(--purple);border:1px solid rgba(91,62,166,0.12)}

  /* search */
  .search{display:flex;gap:8px;margin:12px 0}
  .search input{flex:1;padding:10px;border-radius:6px;border:1px solid #ddd}
  .search button{padding:8px 12px;border-radius:6px;background:var(--cream);border:1px solid rgba(0,0,0,0.06);cursor:pointer}

  /* social */
  .social-row{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}
  .social-btn{
    display:inline-flex;align-items:center;gap:10px;padding:8px 12px;border-radius:999px;color:#fff;text-decoration:none;font-weight:700;
    box-shadow:0 8px 28px rgba(99,66,182,0.12);transition:transform .14s,box-shadow .14s,opacity .14s;
    align-items:center;
  }
  .social-btn .icon{width:18px;height:18px;display:inline-flex;align-items:center;justify-content:center;flex:0 0 18px}
  .social-fb{background:linear-gradient(135deg,var(--purple),var(--purple-2))}
  .social-ig{background:linear-gradient(135deg,#f58529,#dd2a7b,#8134af);background-size:200% 200%}
  .social-mail{background:#fff;color:var(--purple);border:1px solid rgba(91,62,166,0.08)}
  .social-btn:hover{transform:translateY(-4px);box-shadow:0 16px 40px rgba(99,66,182,0.18)}
  .social-mail:hover{background:var(--cream);color:var(--purple)}

  /* modal */
  .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.75);display:none;align-items:center;justify-content:center;z-index:9999;padding:20px}
  .modal-backdrop.active{display:flex}
  .modal-img{max-width:95vw;max-height:95vh;border-radius:8px;box-shadow:0 6px 30px rgba(0,0,0,.6);transition:transform .18s ease}
  #modalClose{position:absolute;top:18px;right:18px;background:transparent;border:0;color:#fff;font-size:22px;cursor:pointer}

  /* footer main layout */
  footer{
    padding:22px 20px;background:var(--footer-bg);border-top:1px solid rgba(0,0,0,0.03);
    color:var(--muted);font-size:14px;
  }
  .footer-grid{max-width:var(--max-width);margin:0 auto;display:grid;grid-template-columns:120px 1fr 260px;gap:18px;align-items:center}
  @media(max-width:900px){ .footer-grid{grid-template-columns:1fr;gap:12px;text-align:center} .footer-grid .footer-col-right{order:3} }

  .footer-logo{
    width:76px;height:76px;border-radius:50%;overflow:hidden;border:3px solid rgba(91,62,166,0.08);display:flex;align-items:center;justify-content:center;background:#fff;margin:auto;
  }
  .footer-logo img{width:64px;height:64px;object-fit:cover;border-radius:50%}

  .footer-nav{display:flex;flex-direction:column;gap:8px}
  .footer-nav a{color:var(--purple);text-decoration:none;font-weight:600}
  .footer-nav a:hover{text-decoration:underline}

  .footer-contact{display:flex;flex-direction:column;gap:8px;align-items:flex-end}
  .footer-contact .contact-row{display:flex;gap:8px;align-items:center}
  .footer-contact a{color:var(--purple);text-decoration:none}
  .footer-small{margin-top:12px;color:var(--muted);font-size:13px}

  /* mobile tweaks */
  @media(max-width:900px){
    .home-cats{grid-template-columns:1fr}
    .gallery-grid{grid-template-columns:repeat(2,1fr)}
    .subject-card{min-height:unset}
    .btn{width:100%}
    .btn-outline{width:auto}
    .footer-contact{align-items:center}
    .footer-nav{flex-direction:row;flex-wrap:wrap;justify-content:center;gap:12px}
    .breadcrumbs{padding-left:6px;padding-right:6px}
  }
  @media(max-width:480px){
    .gallery-grid{grid-template-columns:1fr}
    .hero img{height:160px}
    .logo{height:48px}
    .container{padding:12px}
    .topbar{gap:8px}
    .search input{padding:8px}
    .btn{padding:10px}
  }

  /* small helpers */
  .narrow{text-align:left;max-width:860px;margin:0 auto}
</style>
</head>
<body>

<header>
  <div class="container topbar">
    <button id="hamburgerBtn" class="hamburger" aria-label="Toggle sidebar">☰</button>
    <img id="siteLogo" src="assets/images/hero/logo.jpg" alt="XI-JUDGES logo" class="logo">

    <div>
      <div style="font-weight:700;color:var(--purple)">XI-JUDGES STEM</div>
      <div style="font-size:13px;color:var(--muted)">Official site — for school purposes only</div>
    </div>

    <nav aria-label="Main navigation">
      <ul>
        <li><a href="#home" data-route>Home</a></li>
        <li><a href="#about" data-route>About</a></li>
        <li><a href="#subjects" data-route>Subjects</a></li>
        <li><a href="#gallery" data-route>Gallery</a></li>
        <li><a href="#downloads" data-route>Downloads</a></li>
        <li><a href="#contact" data-route>Contact Us</a></li>
      </ul>
    </nav>
  </div>
</header>

<main class="container">
  <div class="layout">
    <aside class="sidebar" aria-labelledby="note">
      <h4 id="note">NOTE</h4>
      <p style="margin-bottom:10px">This website is an Emptech project made by a group of students under Ma'am Katz Escano.</p>

      <div style="margin-top:6px">
        <div class="muted" style="font-size:13px">Search lessons</div>
        <div class="search" role="search">
          <input id="searchInput" placeholder="search lesson, subject, or tag..." aria-label="Search lessons">
          <button id="searchBtn" type="button" aria-label="Search">Search</button>
        </div>
      </div>
    </aside>

    <section id="mainContent">
      <div class="breadcrumbs" id="breadcrumbs">Home</div>

      <!-- HOME -->
      <div id="page-home">
        <div class="hero" id="hero">
          <img id="heroImg" src="assets/images/hero/gallery1.jpg" alt="hero image">
        </div>

        <h2 style="margin:18px 0 8px 0">Subjects Overview</h2>
        <p style="margin:0 0 12px 0;color:var(--muted)">STEM subjects are grouped into Core, Applied, and Specialized categories. Click a subject to open its lessons.</p>

        <div class="home-cats" id="homeCats" aria-live="polite">
          <!-- categories rendered by JS -->
        </div>
      </div>

      <!-- ABOUT -->
      <div id="page-about" style="display:none">
        <h1>About</h1>
        <div class="narrow">
          <p>This website is designed to guide/help STEM students or anyone who is interested in learning STEM subjects. You will find lessons, reviewers, summaries, videos, and resources to make studying easier.</p>
        </div>
      </div>

      <!-- SUBJECTS (lesson list and subject list) -->
      <div id="page-subjects" style="display:none">
        <h1 id="subjectTitle">Subjects</h1>
        <div id="subjectDesc" style="color:var(--muted);margin-bottom:12px"></div>

        <div id="subjectsList" class="subjects-grid"></div>
        <div id="lessonsList" class="subjects-grid" style="margin-top:12px"></div>
      </div>

      <!-- GALLERY -->
      <div id="page-gallery" style="display:none">
        <h1>Gallery</h1>
        <div class="gallery-grid" id="galleryGrid"></div>
      </div>

      <!-- DOWNLOADS -->
      <div id="page-downloads" style="display:none">
        <h1>Downloads / Resources</h1>
        <div id="downloadsList" class="resources"></div>
      </div>

      <!-- CONTACT -->
      <div id="page-contact" style="display:none">
        <h1>Contact Us</h1>
        <div class="narrow">
          <p>Got any questions? Reach out.</p>
          <div style="margin-top:8px">
            <p style="margin:0 0 8px 0">Email address: <strong>xijudges@gmail.com</strong></p>
            <a class="btn" href="mailto:xijudges@gmail.com" aria-label="Email XI-JUDGES">Email Us</a>

            <div class="social-row" role="list" aria-label="Social links" style="margin-top:12px">
              <a role="listitem" class="social-btn social-fb" href="https://www.facebook.com/profile.php?id=61578623245383" target="_blank" rel="noopener" aria-label="XI-JUDGES on Facebook">
                <span class="icon" aria-hidden="true" style="background:transparent;display:inline-flex">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 12.07C22 6.48 17.52 2 11.93 2S2 6.48 2 12.07c0 4.99 3.66 9.13 8.44 9.93v-7.03H7.9v-2.9h2.54V9.84c0-2.5 1.49-3.88 3.77-3.88 1.09 0 2.23.2 2.23.2v2.45h-1.25c-1.23 0-1.61.77-1.61 1.56v1.87h2.74l-.44 2.9h-2.3V22c4.78-.8 8.44-4.94 8.44-9.93z" fill="#fff"/></svg>
                </span>
                <span>Facebook</span>
              </a>

              <a role="listitem" class="social-btn social-ig" href="https://www.instagram.com/xi_judges" target="_blank" rel="noopener" aria-label="XI-JUDGES on Instagram">
                <span class="icon" aria-hidden="true" style="background:transparent;display:inline-flex">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zM12 8.5A3.5 3.5 0 1 0 15.5 12 3.5 3.5 0 0 0 12 8.5zM17.5 5a1 1 0 1 0 1 1 1 1 0 0 0-1-1z" fill="#fff"/></svg>
                </span>
                <span>Instagram</span>
              </a>

              <a role="listitem" class="social-btn social-mail" href="mailto:xijudges@gmail.com" aria-label="Email XI-JUDGES">
                <span class="icon" aria-hidden="true" style="background:transparent;display:inline-flex">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zm0 4l-8 5-8-5V6l8 5 8-5z" fill="currentColor"/></svg>
                </span>
                <span>Email Us</span>
              </a>
            </div>

            <p style="margin-top:12px;color:var(--muted);font-size:14px">Don't forget to follow our socials</p>
          </div>
        </div>
      </div>

      <!-- LESSON -->
      <div id="page-lesson" style="display:none">
        <div class="lesson" id="lessonView">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
            <div>
              <h1 id="lessonTitle"></h1>
              <div class="meta" id="lessonMeta"></div>
            </div>
          </div>

          <div style="margin-top:14px" id="lessonSummary"></div>
          <div class="resources" id="lessonResources"></div>
          <div id="videoContainer"></div>
        </div>
      </div>

    </section>
  </div>
</main>

<footer>
  <div class="footer-grid" role="contentinfo" aria-label="Footer">
    <div class="footer-col-left" style="display:flex;align-items:center;justify-content:center">
      <div class="footer-logo" aria-hidden="true">
        <img id="footerLogoImg" src="assets/images/hero/logo.jpg" alt="XI-JUDGES logo">
      </div>
    </div>

    <div class="footer-col-center">
      <nav class="footer-nav" aria-label="Footer navigation">
        <a href="#home" data-route>Home</a>
        <a href="#about" data-route>About</a>
        <a href="#subjects" data-route>Subjects</a>
        <a href="#gallery" data-route>Gallery</a>
        <a href="#downloads" data-route>Downloads</a>
        <a href="#contact" data-route>Contact</a>
      </nav>
      <div class="footer-small" style="margin-top:8px">
        <strong>XI-JUDGES STEM</strong> — For school purposes only. Not for commercial use.
      </div>
    </div>

    <div class="footer-col-right footer-contact">
      <div class="contact-row">
        <a class="btn btn-outline" href="mailto:xijudges@gmail.com" aria-label="Email XI-JUDGES">xijudges@gmail.com</a>
      </div>
      <div class="contact-row" style="font-size:13px;color:var(--muted)">
        <span>© 2025 XI-JUDGES STEM</span>
      </div>
    </div>
  </div>
</footer>

<!-- Modal -->
<div id="modalBackdrop" class="modal-backdrop" aria-hidden="true" role="dialog" aria-label="Image preview">
  <button id="modalClose" aria-label="Close">✕</button>
  <img id="modalImage" class="modal-img" alt="Preview">
</div>

<script>
/* ---------- DATA ---------- */
const SITE_DATA = {
  siteName: 'XI-JUDGES STEM',
  homeSlides:[
    'assets/images/hero/gallery1.jpg',
    'assets/images/gallery2.jpg',
    'assets/images/gallery3.jpg'
  ],
  subjects:[
    { id:'emptech', title:'Empowerment Technologies', short:'Applied ICT skills and content development.',
      lessons:[
        {title:'Introduction to ICT', slug:'emptech-intro-ict', summary:'Overview of ICT and its role.', youtube:['https://youtu.be/4hzcT6tMf-M?si=nVxDbXj9BTp6MHcx']},
        {title:'Rules of Netiquette', slug:'emptech-netiquette', summary:'Netiquette and online behavior.', youtube:['https://youtu.be/GXb48ztCGvI?si=7DpaVLpLZkezxC0v']}
      ]
    },
    { id:'genbio', title:'General Biology 1', short:'Cell biology, tissues, mitosis & meiosis, evolution.',
      lessons:[ {title:'Cell Theory', slug:'bio-cell-theory', summary:'Foundational cell theory concepts.', youtube:['https://youtu.be/iu8iqT7lUQc?si=8mtDpm7tNdFupTJy']} ]
    },
    { id:'precalc', title:'Pre-Calculus', short:'Conic sections and transformations.',
      lessons:[ {title:'Introduction to Conic Sections', slug:'precalc-conics', summary:'Overview of conics.', youtube:['https://youtu.be/0A7RR0oy2ho?si=aVhIG6TTo7084MOC']} ]
    },
    { id:'rws', title:'Reading & Writing Skills', short:'Language skills and text analysis.',
      lessons:[ {title:'Basic Language Skills', slug:'rws-basic', summary:'Grammar, vocabulary & usage.', youtube:[]} ]
    },
    { id:'eapp', title:'English for Academic & Professional Purposes', short:'Academic writing and presentations.', lessons:[] },
    { id:'genchem', title:'General Chemistry 1', short:'Properties, substances and gas laws.', lessons:[] },
    { id:'kompan', title:'Komunikasyon at Pananaliksik sa Wika', short:'Filipino communication and research.', lessons:[] },
    { id:'genmath', title:'General Mathematics', short:'Functions and more.', lessons:[] },
    { id:'hope', title:'HOPE', short:'Health-oriented PE and fitness.', lessons:[] }
  ]
};

/* ---------- helpers ---------- */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
function esc(s){ return String(s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
function placeholderDataUrl(text){ text = text || 'Image not found'; return 'data:image/svg+xml;utf8,' + encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='1200' height='675'><rect fill='#f5f4ff' width='100%' height='100%'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='#7a6fb8' font-family='Poppins,Arial' font-size='28'>${text}</text></svg>`); }
function trySourcesOnce(imgEl, sources, fallback){
  if(!imgEl) return;
  if(!Array.isArray(sources) || sources.length === 0){ imgEl.src = fallback || placeholderDataUrl(); return; }
  let i = 0;
  imgEl.onerror = function(){
    i++;
    if(i < sources.length){
      imgEl.onerror = function(){ i++; if(i < sources.length) imgEl.src = sources[i]; else imgEl.src = fallback || placeholderDataUrl(); };
      imgEl.src = sources[i];
    } else {
      imgEl.src = fallback || placeholderDataUrl();
    }
  };
  imgEl.src = sources[0];
}

/* ---------- templates / renderers ---------- */
const SUBJECT_CATEGORIES = {
  "Core Subjects": ['rws','kompan','genmath','hope'],
  "Applied Subjects": ['emptech','eapp'],
  "Specialized Subjects": ['precalc','genbio','genchem']
};

function renderHomeCategories(){
  const container = $('#homeCats'); if(!container) return;
  container.innerHTML = '';
  Object.keys(SUBJECT_CATEGORIES).forEach(catName=>{
    const ids = SUBJECT_CATEGORIES[catName];
    const card = document.createElement('div'); card.className = 'cat-card';
    const inner = document.createElement('div');
    inner.innerHTML = `<h3>${esc(catName)}</h3>`;
    const ul = document.createElement('ul'); ul.className = 'cat-list';
    if(!ids || ids.length === 0){
      const li = document.createElement('li'); li.textContent = 'No subjects listed.';
      ul.appendChild(li);
    } else {
      ids.forEach(id=>{
        const subj = (SITE_DATA.subjects||[]).find(s=>s.id===id);
        const li = document.createElement('li');
        if(subj){
          // include data-route and href to ensure router picks it up
          li.innerHTML = `<a href="#subject/${subj.id}" data-route>${esc(subj.title)}</a> <span style="color:var(--muted);font-size:13px"> — ${esc(subj.short || '')}</span>`;
        } else {
          li.textContent = id + ' (missing)';
        }
        ul.appendChild(li);
      });
    }
    inner.appendChild(ul);
    card.appendChild(inner);
    container.appendChild(card);
  });
}

function renderSubjectsList(){
  const container = $('#subjectsList'); if(!container) return;
  container.innerHTML = '';
  (SITE_DATA.subjects || []).forEach(sub=>{
    const card = document.createElement('div'); card.className = 'subject-card';
    card.innerHTML = `<div><h3>${esc(sub.title)}</h3><p class="muted">${esc(sub.short || '')}</p></div><div style="margin-top:12px"><a href="#subject/${sub.id}" data-route class="btn">Open</a></div>`;
    container.appendChild(card);
  });
}

function renderGallery(){
  const g = $('#galleryGrid'); if(!g) return; g.innerHTML='';
  const images = SITE_DATA.homeSlides || [];
  images.forEach((src,i)=>{
    const d = document.createElement('div'); d.className='thumb';
    const img = document.createElement('img'); img.alt = `gallery ${i+1}`;
    const basename = src.split('/').pop();
    const candidates = [src, `assets/images/hero/${basename}`, `assets/images/${basename}`, `assets/${basename}`].filter(Boolean);
    trySourcesOnce(img, candidates, placeholderDataUrl());
    d.appendChild(img);
    d.addEventListener('click', ()=> openModal(img.src || src));
    g.appendChild(d);
  });
}

function renderDownloads(){
  const container = $('#downloadsList'); if(!container) return; container.innerHTML='';
  (SITE_DATA.subjects || []).forEach(sub=>{
    const sec = document.createElement('section'); sec.style.marginBottom='18px';
    const h = document.createElement('h3'); h.textContent = sub.title; sec.appendChild(h);
    (sub.lessons || []).forEach(lesson=>{
      const row = document.createElement('div'); row.style.marginBottom='8px';
      const t = document.createElement('div'); t.innerHTML = `<strong>${esc(lesson.title)}</strong>`; row.appendChild(t);
      if(Array.isArray(lesson.youtube)) lesson.youtube.forEach(u=>{
        const a = document.createElement('a'); a.href = u; a.target='_blank'; a.rel='noopener'; a.className='btn'; a.style.margin='6px 8px 6px 0'; a.textContent='YouTube'; row.appendChild(a);
      });
      if(Array.isArray(lesson.readingLinks)) lesson.readingLinks.forEach(r=>{
        const a = document.createElement('a'); a.href = r; a.target='_blank'; a.rel='noopener'; a.className='btn'; a.style.margin='6px 8px 6px 0'; a.textContent='Reading'; row.appendChild(a);
      });
      sec.appendChild(row);
    });
    container.appendChild(sec);
  });
}

/* modal */
const modalBackdrop = $('#modalBackdrop');
const modalImage = $('#modalImage');
$('#modalClose').addEventListener('click', ()=> closeModal());
modalBackdrop.addEventListener('click', (e)=> { if(e.target === modalBackdrop) closeModal(); });
function openModal(src){
  const basename = src.split('/').pop();
  const candidates = [src, `assets/images/hero/${basename}`, `assets/images/${basename}`, `assets/${basename}`].filter(Boolean);
  trySourcesOnce(modalImage, candidates, placeholderDataUrl('Preview not found'));
  modalBackdrop.classList.add('active'); modalBackdrop.setAttribute('aria-hidden','false');
}
function closeModal(){ modalBackdrop.classList.remove('active'); modalBackdrop.setAttribute('aria-hidden','true'); modalImage.src = ''; }

/* ---------- router & page rendering ---------- */
function setBreadcrumb(parts){ const el = $('#breadcrumbs'); if(el) el.textContent = parts.join(' > '); }
function showOnly(id){
  const pages = ['page-home','page-about','page-subjects','page-gallery','page-downloads','page-contact','page-lesson'];
  pages.forEach(p=>{ const el=document.getElementById(p); if(!el) return; el.style.display = (p===id)?'block':'none'; });
  window.scrollTo({top:0,behavior:'smooth'});
}

function showHome(){ showOnly('page-home'); setBreadcrumb(['Home']); renderHomeCategories(); }
function showAbout(){ showOnly('page-about'); setBreadcrumb(['About']); }
function showGallery(){ showOnly('page-gallery'); setBreadcrumb(['Gallery']); renderGallery(); }
function showDownloads(){ showOnly('page-downloads'); setBreadcrumb(['Downloads']); renderDownloads(); }
function showContact(){ showOnly('page-contact'); setBreadcrumb(['Contact Us']); }

function showSubjectsList(){ showOnly('page-subjects'); setBreadcrumb(['Subjects']); $('#subjectTitle').textContent='Subjects'; $('#subjectDesc').textContent='All available subjects. Click Open to view lessons.'; $('#subjectsList').style.display='grid'; $('#lessonsList').style.display='none'; renderSubjectsList(); }

function showSubject(subjectId){
  const subj = (SITE_DATA.subjects||[]).find(s=>s.id===subjectId);
  if(!subj){ showSubjectsList(); return; }
  showOnly('page-subjects'); setBreadcrumb(['Subjects', subj.title]);
  $('#subjectTitle').textContent = subj.title;
  $('#subjectDesc').textContent = subj.short || '';
  $('#subjectsList').style.display = 'none';
  $('#lessonsList').style.display = 'grid';
  const list = $('#lessonsList'); list.innerHTML = '';
  (subj.lessons || []).forEach(lesson=>{
    const c = document.createElement('div'); c.className='subject-card';
    c.innerHTML = `<div><h3>${esc(lesson.title)}</h3><p class="muted">${esc(lesson.summary || '')}</p></div><div style="margin-top:12px"><a class="btn" href="#lesson/${subj.id}/${lesson.slug}" data-route>Open lesson</a></div>`;
    list.appendChild(c);
  });
}

function showLesson(subjectId, lessonSlug){
  const subj = (SITE_DATA.subjects||[]).find(s=>s.id===subjectId); if(!subj) return showSubjectsList();
  const lesson = (subj.lessons||[]).find(l=>l.slug===lessonSlug); if(!lesson) return showSubject(subjectId);
  showOnly('page-lesson'); setBreadcrumb(['Subjects',subj.title, lesson.title]);
  $('#lessonTitle').textContent = lesson.title;
  $('#lessonMeta').innerHTML = `<span class="muted">Subject: ${esc(subj.title)}</span>`;
  $('#lessonSummary').textContent = lesson.summary || '';
  const res = $('#lessonResources'); if(res) res.innerHTML = '';
  if(Array.isArray(lesson.readingLinks)) lesson.readingLinks.forEach(link=>{
    const a = document.createElement('a'); a.href = link; a.target='_blank'; a.rel='noopener'; a.className='btn'; a.textContent='Reading'; a.style.marginRight='8px'; res.appendChild(a);
  });
  if(lesson.pdfFilename){ const a=document.createElement('a'); a.href='assets/pdfs/'+lesson.pdfFilename; a.className='btn'; a.textContent='Download PDF'; res.appendChild(a); }
  const vc = $('#videoContainer'); if(vc) vc.innerHTML='';
  if(Array.isArray(lesson.youtube) && lesson.youtube.length){
    lesson.youtube.forEach(url=>{
      const id = (function(u){ try{ if(!u) return null; if(!u.startsWith('http') && /^[A-Za-z0-9_-]{8,}$/.test(u)) return u; const parsed = new URL(u); if(parsed.hostname.includes('youtu.be')) return parsed.pathname.slice(1).split(/[?&#]/)[0]; if(parsed.hostname.includes('youtube.com')){ if(parsed.searchParams.get('v')) return parsed.searchParams.get('v').split(/[?&]/)[0]; if(parsed.pathname.includes('/embed/')) return parsed.pathname.split('/embed/')[1].split(/[?&#]/)[0]; if(parsed.pathname.startsWith('/shorts/')) return parsed.pathname.split('/shorts/')[1].split(/[?&#]/)[0]; } }catch(e){} const m = String(u).match(/(?:v=|\/embed\/|youtu\.be\/|\/shorts\/)([A-Za-z0-9_-]{6,})/); return m?m[1]:null; })(url);
      if(!id) return;
      const wrap = document.createElement('div'); wrap.className = 'video-wrap';
      const iframe = document.createElement('iframe'); iframe.src = `https://www.youtube.com/embed/${id}`; iframe.title='YouTube video'; iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"; iframe.allowFullscreen=true;
      wrap.appendChild(iframe); vc.appendChild(wrap);
    });
  }
}

/* router */
function handleHash(){
  const raw = (location.hash || '').replace(/^#/,'');
  if(!raw || raw==='home'){ showHome(); return; }
  const parts = raw.split('/').map(p=>decodeURIComponent((p||'').trim())).filter(Boolean);
  if(parts.length===0){ showHome(); return; }
  const head = parts[0].toLowerCase();
  if(head==='about') return showAbout();
  if(head==='gallery') return showGallery();
  if(head==='downloads') return showDownloads();
  if(head==='contact') return showContact();
  if(head==='subjects') return showSubjectsList();
  if(head==='subject' && parts[1]) return showSubject(parts[1]);
  if(head==='lesson' && parts[1] && parts[2]) return showLesson(parts[1], parts[2]);
  if((SITE_DATA.subjects||[]).some(s=>s.id===head)) return showSubject(head);
  showHome();
}

/* ---------- boot & event handling ---------- */
window.addEventListener('load', ()=>{
  // Logo + hero fallback
  trySourcesOnce(document.getElementById('siteLogo'), ['assets/images/hero/logo.jpg','assets/logo.jpg','assets/images/logo.jpg','assets/logo.png'], placeholderDataUrl('Logo not found'));
  trySourcesOnce(document.getElementById('footerLogoImg'), ['assets/images/hero/logo.jpg','assets/logo.jpg','assets/images/logo.jpg','assets/logo.png'], placeholderDataUrl('Logo not found'));
  trySourcesOnce(document.getElementById('heroImg'), SITE_DATA.homeSlides || ['assets/images/hero/gallery1.jpg'], placeholderDataUrl('Hero not found'));

  // initial renders
  renderHomeCategories();
  renderSubjectsList();
  renderGallery();
  renderDownloads();

  // hamburger toggle
  const hamb = document.getElementById('hamburgerBtn');
  hamb?.addEventListener('click', ()=> {
    if(window.innerWidth <= 900){ document.body.classList.toggle('sidebar-open'); }
    else { document.body.classList.toggle('sidebar-hidden'); }
  });

  // Close mobile sidebar on outside click
  document.addEventListener('click', (e)=>{
    if(window.innerWidth <= 900 && document.body.classList.contains('sidebar-open')){
      const inside = e.target.closest('.sidebar') || e.target.closest('#hamburgerBtn');
      if(!inside) document.body.classList.remove('sidebar-open');
    }
  });

  // Improved navigation click handler:
  // - Intercept any <a href="#..."> (internal) and set location.hash (prevents default jump)
  // - Allow external links (mailto:, http(s):, tel:) to behave normally
  document.body.addEventListener('click', (e)=>{
    const a = e.target.closest('a');
    if(!a) return;

    const href = a.getAttribute('href') || '';
    // Skip if link has target _blank or is external
    if(href.startsWith('mailto:') || href.startsWith('tel:') || href.startsWith('http://') || href.startsWith('https://')) {
      return; // allow default
    }

    if(href.startsWith('#')) {
      e.preventDefault();
      const target = href.replace(/^#/,'');
      // set hash - this triggers hashchange -> handleHash
      location.hash = target;
      // close sidebar on mobile for better UX
      if(document.body.classList.contains('sidebar-open')) document.body.classList.remove('sidebar-open');
      return;
    }
  });

  // search enter / button
  const si = $('#searchInput');
  si?.addEventListener('keydown', (ev)=>{ if(ev.key === 'Enter'){ ev.preventDefault(); doSearch(); } });
  $('#searchBtn')?.addEventListener('click', (ev)=>{ ev.preventDefault(); doSearch(); });

  window.addEventListener('hashchange', handleHash);

  // Run router once at load (after renders)
  handleHash();
});
</script>
</body>
</html>